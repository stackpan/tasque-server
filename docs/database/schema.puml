@startuml Tasque database schema

entity users {
    * id : uuid
    * username : varchar(16)
    email : string
    * first_name : varchar(32)
    last_name : varchar(64)
    profile_picture_url : varchar(1024)
    * password : varchar(4096)
    emailVerifiedAt : timestamptz
    * created_at : timestamptz
    * updated_at : timestamptz
    deleted_at : timestamptz
    --
    unique(username)
    unique(email)
}

entity teams {
    * id : uuid
    * name : varchar(32)
    description: varchar(1024)
    profile_picture_url : varchar(1024)
    * created_at : timestamptz
    * updated_at : timestamptz
    deleted_at : timestamptz
    --
}

entity team_members {
    * id : uuid
    * user_id : uuid
    * team_id : uuid
    * role : enum('owner', 'editor', 'viewer')
    * created_at : timestamptz
    * updated_at : timestamptz
    --
    unique(user_id, team_id)
}

entity user_team_invitations {
    * id : uuid
    * from_user_id : uuid
    * to_user_id : uuid
    * team_id : uuid
    * role : enum('editor', 'viewer')
    is_accepted : boolean
    responded_at : timestamptz
    cancelled_at : timestamptz
    * created_at : timestamptz
    * updated_at : timestamptz
    --
    unique(from_user_id, to_user_id, team_id)
}

entity boards {
    * id : uuid
    * name : varchar(64)
    description : varchar(1024)
    banner_picture_url : varchar(1024)
    color_hex : varchar(7)
    * owner_id : uuid
    * owner_type : enum('user', 'team')
    * created_at : timestamptz
    * updated_at : timestamptz
    deleted_at : timestamptz
    --
}

entity columns {
    * id : uuid
    * board_id : uuid
    * name : varchar(64)
    description : varchar(128)
    color_hex : varchar(7)
    next_column_id : uuid
    * created_at : timestamptz
    * updated_at : timestamptz
    --
}

entity cards {
    * id : uuid
    * column_id : uuid
    * body : varchar(1024)
    color_hex : varchar(7)
    * created_at : timestamptz
    * updated_at : timestamptz
    --
}

entity comments {
    * id : uuid
    * user_id : uuid
    * body : varchar(128)
    * context_id : uuid
    * context_type : enum('board', 'column', 'card')
    * created_at : timestamptz
    * updated_at : timestamptz
    --
}

entity histories {
    * id : uuid
    * user_id : uuid
    * action : enum('create', 'update', 'delete')
    * context_id : uuid
    * context_type : enum('board', 'column', 'card')
    * context_key : varchar(256),
    context_value_before : text
    context_value_after : text
    * created_at : timestamptz
    --
}

users ||--|{ team_members
teams ||--|{ team_members
users ||--|{ user_team_invitations
users ||--|{ user_team_invitations
teams ||--|{ user_team_invitations
boards ||--|{ columns
columns |o--|| columns
columns ||--|{ cards
users ||--|{ comments
users ||--|{ histories

@enduml